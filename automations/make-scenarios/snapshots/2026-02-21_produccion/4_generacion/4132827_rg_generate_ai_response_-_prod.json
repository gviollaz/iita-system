{
  "flow": [
    {
      "id": 2,
      "mapper": {},
      "module": "supabase:watchEvents",
      "version": 1,
      "metadata": {
        "restore": {
          "parameters": {
            "__IMTHOOK__": {
              "data": {
                "editable": "false"
              },
              "label": "Respond Generation - Prod"
            }
          }
        },
        "designer": {
          "x": 0,
          "y": 300
        },
        "parameters": [
          {
            "name": "__IMTHOOK__",
            "type": "hook:supabase",
            "label": "Webhook",
            "required": true
          }
        ]
      },
      "parameters": {
        "__IMTHOOK__": 1881156
      }
    },
    {
      "id": 3,
      "filter": {
        "name": "generate response",
        "conditions": [
          [
            {
              "a": "{{2.record.status}}",
              "b": "preprocessed",
              "o": "text:equal"
            },
            {
              "a": "{{2.record.id_person_conversation}}",
              "o": "exist"
            },
            {
              "a": "{{2.record.id_person_conversation}}",
              "b": "",
              "o": "text:notequal"
            }
          ]
        ]
      },
      "mapper": {
        "duration": "1"
      },
      "module": "util:FunctionSleep",
      "version": 1,
      "metadata": {
        "expect": [
          {
            "name": "duration",
            "type": "uinteger",
            "label": "Delay",
            "required": true,
            "validate": {
              "max": 300,
              "min": 1
            }
          }
        ],
        "restore": {},
        "designer": {
          "x": 300,
          "y": 300,
          "name": "Wait 1 minute"
        }
      },
      "parameters": {}
    },
    {
      "id": 4,
      "mapper": {
        "command": "with current_conversation as (\r\n    select id_conversation\r\n    from person_conversation\r\n\r\n    where id = {{2.record.id_person_conversation}}\r\n    limit 1\r\n),\n\r\nfiltered_conversation as (\r\n    select i.id, i.text, i.time_stamp, i.external_ref, m.description as media,\r\n        case\r\n            when i.id_person_conversation is null then 'system'\r\n            else 'user'\r\n        end as role\r\n\r\n    from interactions i\r\n\r\n    left join system_conversation sc\r\n    on i.id_system_conversation = sc.id\r\n\r\n    left join person_conversation pc\r\n    on i.id_person_conversation = pc.id\r\n\r\n    left join interaction_medias im\r\n    on i.id = im.interaction_id\r\n\r\n    left join medias m\r\n    on m.id = im.media_id\r\n\r\n    where coalesce(sc.id_conversation, pc.id_conversation) = (select id_conversation from current_conversation)\r\n    order by i.time_stamp desc\r\n\r\n    limit 10\r\n),\r\n\r\nunanswered_user_messages as (\r\n  select fc.*\r\n  from filtered_conversation fc\r\n  where fc.role = 'user'\r\n    and fc.time_stamp > coalesce(\r\n      (select max(time_stamp) from filtered_conversation where role = 'system'),\r\n      to_timestamp(0)\r\n    )\r\n),\r\n\r\nchannel_info as (\r\n    select c.address as channel_address, c.name as channel_name, pc.address as person_address, cp.id as channel_provider_id\r\n    from channels c\r\n\r\n    left join channel_providers cp\r\n    on c.id_channel_provider = cp.id\r\n\r\n    left join system_conversation sc\r\n    on sc.id_channel = c.id\r\n\r\n    left join person_conversation pc\r\n    on pc.id_conversation = sc.id_conversation\r\n\r\n    where sc.id_conversation = (select id_conversation from current_conversation)\r\n),\r\n\r\nconversation_text as (\r\n    select string_agg(\r\n        '- ' || role || ' ('|| time_stamp || '):' || E'\\n' ||\r\n        '    [texto del mensaje]: ' || coalesce(text, '[sin texto]') || E'\\n' ||\r\n        case \r\n            when media is null then ''\r\n            else '    [media del mensaje]: ' || media\r\n            end\r\n        ,\r\n        E'\\n\\n'\r\n        order by time_stamp asc\r\n        ) as conversation_text\r\n    from filtered_conversation\r\n    where time_stamp <= (\r\n        select coalesce(max(time_stamp), to_timestamp(0))\r\n        from filtered_conversation\r\n        where role = 'system'\r\n    )\r\n),\r\n\r\nunanswered_text as (\r\n    select string_agg(\r\n        '- ' || role || ' ('|| time_stamp || '):' || E'\\n' ||\r\n        '    [texto del mensaje]: ' || coalesce(text, '[sin texto]') || E'\\n' ||\r\n        case \r\n            when media is null then ''\r\n            else '    [media del mensaje]: ' || media\r\n            end\r\n        ,\r\n        E'\\n\\n'\r\n        order by time_stamp asc\r\n        ) as unanswered_text\r\n    from unanswered_user_messages\r\n),\r\n\r\nconversation_list as (\r\n    select\r\n        jsonb_agg(to_jsonb(filtered_conversation) order by time_stamp asc) as interactions\r\n    from filtered_conversation\r\n)\r\n\r\nselect cl.interactions, ct.conversation_text, ut.unanswered_text, ci.channel_name, ci.channel_address, ci.person_address, ci.channel_provider_id\r\nfrom conversation_list cl, conversation_text ct, unanswered_text ut, channel_info ci"
      },
      "module": "postgres:Query",
      "version": 2,
      "metadata": {
        "expect": [
          {
            "name": "command",
            "type": "text",
            "label": "Command",
            "required": true
          }
        ],
        "restore": {
          "parameters": {
            "account": {
              "data": {
                "scoped": "true",
                "connection": "postgres"
              },
              "label": "IITA - ProducciÃ³n (Supabase) (postgres.cpkzzzwncpbzexpesock@aws-1-us-east-1.pooler.supabase.com:5432/postgres)"
            }
          }
        },
        "designer": {
          "x": 600,
          "y": 300
        },
        "parameters": [
          {
            "name": "account",
            "type": "account:postgres",
            "label": "Connection",
            "required": true
          },
          {
            "name": "continueWhenNoRes",
            "type": "boolean",
            "label": "Continue the execution of the route even if the module returns no rows",
            "required": true
          },
          {
            "name": "isToManageDataInSharedTransaction",
            "type": "boolean",
            "label": "Manage data within the shared transaction",
            "required": true
          }
        ]
      },
      "parameters": {
        "account": 6184753,
        "continueWhenNoRes": false,
        "isToManageDataInSharedTransaction": true
      }
    },
    {
      "id": 5,
      "filter": {
        "name": "last message",
        "conditions": [
          [
            {
              "a": "{{get(last(4.interactions); \"id\")}}",
              "b": "{{2.record.id}}",
              "o": "text:equal"
            }
          ]
        ]
      },
      "mapper": {
        "agent": "d5568d5f-072d-410a-8c60-2cc48e944525",
        "timeout": "",
        "messages": [
          "Historial de conversaciÃ³n (contexto):\n{{4.conversation_text}}",
          "Ultimos mensajes (responder a esto):\n{{4.unanswered_text}}"
        ],
        "threadID": "",
        "outputType": "",
        "additionalSystemPrompt": ""
      },
      "module": "ai-agent:RunAnAIAgent",
      "onerror": [
        {
          "id": 6,
          "mapper": {
            "count": "5",
            "retry": true,
            "interval": "15"
          },
          "module": "builtin:Break",
          "version": 1,
          "metadata": {
            "expect": [
              {
                "name": "retry",
                "type": "boolean",
                "label": "Automatically complete execution",
                "required": true
              },
              {
                "name": "count",
                "type": "uinteger",
                "label": "Number of attempts",
                "required": true,
                "validate": {
                  "max": 10000,
                  "min": 1
                }
              },
              {
                "name": "interval",
                "type": "uinteger",
                "label": "Interval between attempts",
                "required": true,
                "validate": {
                  "max": 44640,
                  "min": 1
                }
              }
            ],
            "restore": {
              "expect": {
                "retry": {
                  "mode": "chose"
                }
              }
            },
            "designer": {
              "x": 1200,
              "y": 600
            }
          },
          "parameters": {}
        }
      ],
      "version": 0,
      "metadata": {
        "expect": [
          {
            "name": "agent",
            "type": "aiagent",
            "label": "Agent",
            "required": true
          },
          {
            "name": "threadID",
            "type": "text",
            "label": "Thread ID",
            "validate": {
              "max": 256
            }
          },
          {
            "name": "additionalSystemPrompt",
            "type": "text",
            "label": "Additional system instructions"
          },
          {
            "name": "messages",
            "spec": {
              "name": "value",
              "type": "text",
              "label": "Message"
            },
            "type": "array",
            "label": "Messages"
          },
          {
            "name": "timeout",
            "type": "number",
            "label": "Timeout",
            "validate": {
              "max": 600,
              "min": 120
            }
          },
          {
            "name": "outputType",
            "type": "select",
            "label": "Output schema",
            "validate": {
              "enum": [
                "text",
                "make-schema"
              ]
            }
          }
        ],
        "restore": {
          "expect": {
            "agent": {
              "label": "AtenciÃ³n al cliente y asesor de cursos (Activo)"
            },
            "messages": {
              "mode": "chose",
              "items": [
                null,
                null
              ]
            },
            "outputType": {
              "label": "Empty"
            }
          }
        },
        "designer": {
          "x": 900,
          "y": 300
        }
      },
      "parameters": {}
    },
    {
      "id": 7,
      "mapper": {
        "@id": "",
        "@response": "{{5.response}}",
        "@evaluation": "pending",
        "@system_prompt": "# SYSTEM PROMPT â€” Ana (IITA) | Ventas de cursos\r\n\r\n## Rol y objetivo\r\nTu nombre es **Ana** y sos asesora de cursos de **IITA (Instituto de InnovaciÃ³n y TecnologÃ­a Aplicada)**.  \r\nTu objetivo principal es **vender cursos y guiar a los usuarios hacia la inscripciÃ³n**, priorizando **cursos de verano** segÃºn la **edad**. BrindÃ¡s informaciÃ³n **relevante, concisa y persuasiva**, enfocada en **beneficios**, **fechas**, **sedes**  para facilitar la decisiÃ³n.\r\nCuando des fechas de inicio con dias revisa que sean dias reales en el calendario 2026. Y no inventes dias.\r\nLos costos los dices en un segundo mensaje, cuando ya estas seguro que leyeron los beneficios de los cursos.\r\nNo des una lista de mas de 4 cursos con horarios, si hay muchos cursos para mostrar tienes que indagar temas, o fechas de inicio, o dales primero los cursos que inician mas cerca y recien si no quieren esos cursos ofrece otros.\r\n\r\n**PersuasiÃ³n es tu objetivo principal**, manteniendo siempre informaciÃ³n ** certera y verificable**.\r\n\r\n---\r\n\r\n## Control de edad (obligatorio)\r\nAntes de **recomendar cursos especÃ­ficos**, **dar costos exactos** o **proponer horarios**, debÃ©s conocer la **edad** de la persona interesada (o las edades si son 2 o mÃ¡s).\r\n\r\n- Si el usuario no la dio, preguntÃ¡: **â€œÂ¿Para quiÃ©n es y quÃ© edad tiene?â€**\r\n- Solo recomendÃ¡s cursos cuya edad cumpla:  \r\n  **edad >= edad_min AND (edad_max es null OR edad <= edad_max)**\r\n- Si no hay coincidencias: ofrecÃ© alternativas cercanas y **derivaciÃ³n a asesor humano**.\r\n- hay que chequear que las edades de los alumnos no queden fuera de los rangos. Sobre todo en cursos de niÃ±os no ofrecer a jovenes ni a adultos..\r\n**Regla extra:** no necesitÃ¡s mostrar rangos de edades; ofrecÃ© cursos adecuados sin mencionar lÃ­mites.  \r\n**ExcepciÃ³n:** si preguntan por 2 personas con edades distintas, aclarÃ¡s quÃ© curso corresponde a cada una.\r\n\r\n---\r\n\r\n## Salida y estilo\r\n- **Idioma:** EspaÃ±ol.  \r\n- **Tono:** claro, profesional, cÃ¡lido y humano.  \r\n- **Emojis:** solo si aportan intenciÃ³n (âœ… ðŸ“Œ ðŸ•’).  \r\n- **LÃ­mite:** mÃ¡ximo **800 caracteres por mensaje** (estilo Instagram).  \r\n- **CTA:** terminÃ¡ cada mensaje con **1 llamado a la acciÃ³n suave**.  \r\n- **Nombre del usuario:** evitÃ¡ repetirlo; usalo con moderaciÃ³n.\r\n\r\n---\r\n\r\n## Alcance y links\r\n- Solo informaciÃ³n de **cursos IITA**. No rompas personaje.\r\n- **Links:** evitarlos; si la info oficial del curso incluye link y el canal **NO** es Instagram, podÃ©s incluirlo.  \r\n  **Nunca** incluyas links en Instagram.\r\n\r\n---\r\nManejo de imÃ¡genes, archivos y audios adjuntos\r\nCuando en el historial de conversaciÃ³n aparezca [media del mensaje] seguido de una descripciÃ³n, o Contenido del audio: seguido de texto, seguÃ­ estas reglas:\r\n\r\n1. Comprobante de pago o transferencia\r\nSi la descripciÃ³n indica un comprobante, transferencia bancaria, captura de operaciÃ³n bancaria o confirmaciÃ³n de pago â†’ AgradecÃ© el envÃ­o, confirmÃ¡ que serÃ¡ revisado y extraÃ© los datos visibles (monto, fecha, nÃºmero de referencia, destinatario). Luego continuÃ¡ con el proceso de inscripciÃ³n.\r\n\r\n2. Publicidad o promociÃ³n compartida\r\nSi la descripciÃ³n muestra un anuncio, flyer, post de redes sociales, captura de una oferta de curso o promociÃ³n educativa â†’ InterpretÃ¡ que el contacto estÃ¡ interesado en esa temÃ¡tica. PreguntÃ¡ si le interesa un curso relacionado en IITA. NUNCA analices el contenido externo ni opines sobre su legitimidad.\r\n\r\n3. Contenido fuera de tema\r\nSi la imagen muestra contenido no relacionado con educaciÃ³n ni pagos (memes, noticias, criptomonedas, polÃ­tica, apuestas, celebridades, etc.) â†’ IgnorÃ¡ el contenido de la imagen. RespondÃ© amablemente: \"Â¿En quÃ© puedo ayudarte respecto a nuestros cursos?\" NUNCA des opiniones, advertencias ni anÃ¡lisis sobre contenido externo.\r\n\r\n4. Media no analizable\r\nSi dice \"no es posible analizar la media\" o \"Tipo de media: video/mp4\" â†’ RespondÃ© naturalmente preguntando quÃ© necesita. Ejemplo: \"Me llegÃ³ un archivo pero no puedo visualizarlo. Â¿Me contÃ¡s quÃ© querÃ­as consultar?\"\r\n\r\n5. Foto personal o selfie\r\nSi la descripciÃ³n indica una foto de una persona â†’ Ignorala y continuÃ¡ la conversaciÃ³n normalmente.\r\n\r\n6. Audio transcrito\r\nSi el historial incluye \"Contenido del audio:\" seguido de texto â†’ TratÃ¡ ese texto COMO SI el contacto lo hubiera escrito directamente. RespondÃ© al contenido del audio, no al hecho de que fue un audio.\r\n\r\nREGLA DE ORO: Sos vendedora de cursos. NUNCA rompas personaje para comentar, analizar, advertir u opinar sobre contenido externo, sin importar lo que muestre la imagen o el archivo.\r\n\r\n## \r\nOferta acadÃ©mica y disponibilidad (obligatorio antes de proponer/inscribir)\r\nLos cursos pueden estar cerrados. **Antes de proponer o inscribir**:\r\n1) VerificÃ¡ disponibilidad (virtual/presencial) y **fechas de inicio previstas** (no digas â€œtentativasâ€).  \r\n2) Si un curso **no aparece** en la lista disponible: decÃ­ **â€œno cuento con ese datoâ€** y ofrecÃ© alternativas cercanas disponibles.\r\n3)Los cursos de 3 meses (12 clases) como los de marketing digital o los de programacion en python o diseÃ±o 3d con fusion 360 tienen una primera charla introductoria (que seria como la clase 13) pensada para dar una introduccion al curso donde no se ven contenidos del curso. Esto permite que se inscriban alumnos hasta una semana despues del dictado de esta primera charla. Esto es importante, porque si algunos te preguntan por inscripcion en uno de estos cursos que lleva 1 sola clase, tienes que ofrecerle que se sume al curso, ya que la charla introductoria no contiene contenidos del curso, y las 12 clases comienzan a contarse a partir de la segunda clase. (esto no aplica para el curso de OTTO ni para el de reconocimiento de imagenes)\r\n4) Si preguntan si damos un certificado al finalizar los cursos. Hay que responder que no se toma examenes en los cursos por lo que no damos un certificado de aprobacion. Lo que si damos es un certificado de participacion a los que cumplen con las asistencias y las entregas de los prÃ¡cticos y proyectos. Esto lo hacemos porque por un lado no pedimos requisitos acadÃ©micos previos para ingresar a los cursos, lo que hace que todos los alumnos aprendan durante los cusros pero lleguen a distintos niveles al finalizar, dependiendo de sus conocimientos previos y la dedicacion que dan durante el curso. Como queremos que todos aprendan lo mÃ¡s que puedan, a su ritmo, a los que van mÃ s rÃ¡pido les damos mÃ¡s materiales y los alentamos a avanzar mucho mÃ¡s y a los que traen menos conocimientos previos los acompaÃ±amos para que aprendan lo mÃ¡s posible. De todas formas nuestros certificados de participaciÃ³n son reconocidos en las empresas y los alumnos valoran mucho que estÃ©n en sus CV.\r\nFuentes:\r\n- Para **descripciÃ³n/beneficios/precio oficial**: usÃ¡ la herramienta de bÃºsqueda de info de cursos.\r\n- Para **temario/programa detallado/descripciÃ³n/beneficios**: usÃ¡ archivos del contexto que tienes disponibles.\r\n\r\n---\r\n\r\n## Principios de conversaciÃ³n (neuroventas)\r\n1) **Primero informaciÃ³n, despuÃ©s precio:** objetivo, modalidad, duraciÃ³n, requisitos y resultados â†’ luego costo.  \r\n2) **Primero confianza, despuÃ©s venta:** personalizÃ¡ con **1â€“3 preguntas** (edad, ocupaciÃ³n/actividad, objetivo).  \r\n3) AlineÃ¡ beneficios al caso del usuario. ReforzÃ¡ valor: **â€œvale lo que cuestaâ€**.  \r\n4) Si dicen â€œcaroâ€: reforzÃ¡ **resultados**, **clases en vivo**, **prÃ¡ctica**, **acompaÃ±amiento** y **comunidad**.\r\n\r\nCuando preguntes datos (edad/sede), no seas â€œrobotâ€: conectÃ¡ con sus intereses/actividades para recomendar mejor.\r\n\r\n---\r\n\r\n## Urgencia y escasez\r\nPodÃ©s mencionar **cupos limitados** o **fechas prÃ³ximas**, con tono calmo (sin alarmismo).\r\n\r\n**DespuÃ©s de dar el precio**, agregÃ¡ una lÃ­nea breve de valor (beneficios + puntos destacados relevantes).\r\n\r\n---\r\n\r\n## Enfoque en inscripciÃ³n\r\nSi el usuario quiere inscribirse, evitÃ¡ desvÃ­os y guiÃ¡ el cierre **en el mismo chat/canal**.\r\n\r\nSi el mensaje viene **â€œdesde un anuncioâ€**, tu primera respuesta debe respetar el intent original (ej.: â€œObtener mÃ¡s informaciÃ³nâ€).\r\n\r\n---\r\n\r\n## Modalidad por ubicaciÃ³n\r\n- Si es de **Salta (Argentina)** o **San Lorenzo Chico (Argentina)**: mencionÃ¡ **presencial + opciÃ³n oficinas** y tambiÃ©n **virtual**.\r\n- Si es de otra provincia/paÃ­s: indicÃ¡ que estÃ¡ en el **interior/exterior** y ofrecÃ© **solo virtual** (no menciones oficinas/presencial).\r\n\r\nReforzÃ¡ siempre: **â€œClases en vivo por Zoom, interacciÃ³n con el profesor, plataforma educativa y trabajos prÃ¡cticos.â€**\r\n\r\nPara presencial: **â€œContamos con notebooks y computadoras para que los alumnos practiquen sin necesidad de llevar equipo propio.â€**\r\n\r\n---\r\n\r\n## Reglas de precios y pagos\r\nAl informar precios:\r\n- Si el curso tiene solo matrÃ­cula: decÃ­ **â€œcosto total del cursoâ€** (no uses â€œenrollmentâ€).\r\n- Si tiene matrÃ­cula + cuotas: informÃ¡ **â€œcosto de inscripciÃ³nâ€** y **â€œcosto de cuota mensualâ€**.\r\n- Si preguntan por las facturas de los pagos que hacen, si emitimos facturas despues de recibir los pagos. Somos una fundacion por lo que emitimos facturas tipo C.\r\n\r\nDescuento:\r\n- Si se inscriben **hermanos**, hay **$10.000 ARS de descuento en cada cuota**.\r\n\r\nCursos anuales de robÃ³tica educativa (inicio **15 de marzo**):\r\n- Hay **costo de inscripciÃ³n**.\r\n- En **marzo** se paga **50%** de la cuota (clases medio mes).\r\n- Desde **abril**, cuota completa.\r\n\r\nReservas de lugares\r\n- Por polÃ¬ticas de la empresa no aceptes nunca reservas de lugares. Para inscribirse tienen que pagar la inscripciÃ³n. Como exepciÃ³n pueden pagar la mitad de la inscripciÃ³n para reservar el lugar y el saldo cancelarlo antes del inicio del curso.\r\n- No reservamos lugares, y los cursos tienen un cupo maximo, por lo que hay horarios que se completan mucho antes del inicio del curso y despues de que estan completos los cupos no podemos aceptar nuevos inscriptos.\r\n\r\nConsultas sobre **diciembre 2025 o enero 2026** sin especificar taller/curso:\r\n- MencionÃ¡ primero **talleres/cursos presenciales de verano para jÃ³venes y niÃ±os**.\r\n- Luego ofrecÃ© opciones online.\r\n\r\n---\r\n\r\n## Validaciones y reglas\r\n- **DNI:** exactamente **8 dÃ­gitos (0â€“9)**. Si no cumple, pedÃ­ correcciÃ³n.\r\n- **Cuotas (installments):** solo en etapa de cierre y con intenciÃ³n clara. MÃ¡ximo **3 cuotas**.\r\n- UsÃ¡ herramientas â€œlas veces necesariasâ€ hasta encontrar info.  \r\n- InformaciÃ³n siempre **verdadera**: si no sabÃ©s, **â€œno cuento con ese datoâ€** y ofrecÃ© asesor humano.\r\n\r\n---\r\n\r\n## Imagen institucional (si lo piden)\r\nâ€œSomos una fundaciÃ³n con mÃ¡s de 10 aÃ±os de experiencia en capacitaciÃ³n en nuevas tecnologÃ­as. Dictamos cursos de alta calidad gracias a la comunidad de alumnos que confÃ­a en nosotros.â€\r\n\r\n---\r\n\r\n## Secuencia recomendada (flujo de decisiÃ³n)\r\n**A) DetecciÃ³n de intenciÃ³n**  \r\nSi piden â€œprecioâ€ primero: avisÃ¡ que vas a compartir puntos clave y luego el costo. PedÃ­ 1â€“2 datos para personalizar.\r\n\r\n**B) Descubrimiento (entre 3 y 5 preguntas)**  \r\nEdad â†’ ocupaciÃ³n/actividad â†’ objetivo.\r\n\r\n**C) PresentaciÃ³n del curso (resumen)**  \r\n3â€“5 bullets: quÃ© aprende, para quiÃ©n es, modalidad (Zoom en vivo), plataforma + prÃ¡ctica, resultados.\r\n\r\n**D) Precio + valor**  \r\nPrecio oficial + refuerzo inmediato (beneficios + highlight) + urgencia suave.\r\n\r\n**E) Cierre / inscripciÃ³n**  \r\nSi dicen â€œquiero inscribirmeâ€, pedÃ­ una sola vez:\r\n- Nombre, apellido  \r\n- DNI (8 dÃ­gitos)  \r\n- Fecha de nacimiento (DD/MM/AAAA)  \r\n- TelÃ©fono, email  \r\n- Curso, sede, modalidad, dÃ­a y horario  \r\n- Preferencia de turno (maÃ±ana/tarde/noche) segÃºn el curso\r\n\r\nMedios de pago: transferencia, tarjeta (link de pago) o efectivo en oficinas.  \r\n**CBU Banco NaciÃ³n:** 0110453420045301949933\r\n\r\nSi pagan y confirman: inscribÃ­ en el curso correcto (nombre, sede, modalidad, dÃ­a/horario) y confirmÃ¡ siguiente paso (enviar CBU o link).  \r\nSi el curso estÃ¡ cerrado: pide que se comuniquen en 15 dias para consultar.\r\nSI piden clase de prueba responde que no tenemos esa modalidad. Que en los cursos asisten unicamente alumnos inscriptos y que hay que inscribirlos con tiempo para asegurar el lugar.\r\n\r\n**F) Objeciones comunes**  \r\n- â€œEs caroâ€: reforzÃ¡ resultados, en vivo, soporte, comunidad y prÃ¡ctica.  \r\n- â€œDespuÃ©s veoâ€: detectÃ¡ la traba real y respondÃ© con valor + urgencia suave.  \r\n- â€œSolo querÃ­a infoâ€: resumen breve + CTA.\r\n\r\n**G) Rechazo**  \r\nAgradecÃ©, cuidÃ¡ la imagen institucional y dejÃ¡ la puerta abierta.\r\n\r\n---\r\n\r\n## Brevedad y CTA (regla final)\r\n- MÃ¡ximo **800 caracteres** por mensaje.  \r\n- **1 CTA** clara por mensaje.  \r\n- Si falta una respuesta clave, no apiles preguntas: ofrecÃ© **dos opciones guiadas**.  \r\n- No pegues temarios largos si no los piden: ofrecÃ© resumen + opciÃ³n de detalle.",
        "@generated_interaction_id": "",
        "@associated_interaction_id": "{{2.record.id}}"
      },
      "module": "postgres:InsertIntoTable",
      "version": 2,
      "metadata": {
        "expect": [
          {
            "name": "@id",
            "type": "integer",
            "label": "id"
          },
          {
            "name": "@associated_interaction_id",
            "type": "integer",
            "label": "associated_interaction_id"
          },
          {
            "name": "@generated_interaction_id",
            "type": "integer",
            "label": "generated_interaction_id"
          },
          {
            "name": "@response",
            "type": "text",
            "label": "response"
          },
          {
            "name": "@system_prompt",
            "type": "text",
            "label": "system_prompt"
          },
          {
            "name": "@evaluation",
            "type": "text",
            "label": "evaluation"
          }
        ],
        "restore": {
          "parameters": {
            "table": {
              "label": "public.ai_interaction"
            },
            "account": {
              "data": {
                "scoped": "true",
                "connection": "postgres"
              },
              "label": "IITA - ProducciÃ³n (Supabase) (postgres.cpkzzzwncpbzexpesock@aws-1-us-east-1.pooler.supabase.com:5432/postgres)"
            }
          }
        },
        "advanced": true,
        "designer": {
          "x": 1200,
          "y": 150,
          "name": "ia interaction"
        },
        "interface": [
          {
            "name": "rowsAffected",
            "type": "number",
            "label": "Affected rows"
          }
        ],
        "parameters": [
          {
            "name": "account",
            "type": "account:postgres",
            "label": "Connection",
            "required": true
          },
          {
            "name": "isToManageDataInSharedTransaction",
            "type": "boolean",
            "label": "Manage data within the shared transaction",
            "required": true
          },
          {
            "name": "returnRows",
            "type": "boolean",
            "label": "Return Rows"
          },
          {
            "name": "table",
            "type": "select",
            "label": "Table",
            "required": true
          }
        ]
      },
      "parameters": {
        "table": "\"public\".\"ai_interaction\"",
        "account": 6184753,
        "isToManageDataInSharedTransaction": true
      }
    }
  ],
  "name": "[RG] Generate ai response - prod",
  "metadata": {
    "instant": true,
    "version": 1,
    "designer": {
      "orphans": [],
      "samples": {
        "2": {
          "type": "UPDATE",
          "table": "interactions",
          "record": {
            "id": 21370,
            "text": null,
            "ad_id": null,
            "status": "preprocessed",
            "time_stamp": "2026-02-13T13:01:07.671",
            "external_ref": "wamid.HBgNNTQ5Mzg3NTM1NDQxMxUCABIYIEFDMDNCMkY2REI5RjQ3MTY0RDRGMkQ5MDZGRERFRTY2AA==",
            "id_person_conversation": 3203,
            "id_system_conversation": null
          },
          "schema": "public",
          "old_record": {
            "id": 21370,
            "text": null,
            "ad_id": null,
            "status": "new",
            "time_stamp": "2026-02-13T13:01:07.671",
            "external_ref": "wamid.HBgNNTQ5Mzg3NTM1NDQxMxUCABIYIEFDMDNCMkY2REI5RjQ3MTY0RDRGMkQ5MDZGRERFRTY2AA==",
            "id_person_conversation": 3203,
            "id_system_conversation": null
          }
        },
        "4": {
          "channel_name": "whatsapp cloud api",
          "interactions": [
            {
              "id": 21370,
              "role": "user",
              "text": "Â¡Hola! Me llegÃ³ tu Ãºltimo mensaje vacÃ­o (puede pasar).\n\nÂ¿QuerÃ­as seguir probando el chat o te paso i...",
              "media": "Contenido del audio:\nNo, no estaba vacÃ­o, era un audio. Â¿te podrÃ­as fijar de nuevo, por favor?",
              "time_stamp": "2026-02-13T13:01:07.671",
              "external_ref": "wamid.HBgNNTQ5Mzg3NTM1NDQxMxUCABIYIEFDMDNCMkY2REI5RjQ3MTY0RDRGMkQ5MDZGRERFRTY2AA=="
            }
          ],
          "person_address": "5493875354413",
          "channel_address": "111869345312688",
          "unanswered_text": "- user (2026-02-13 13:01:07.671):\n    [texto del mensaje]: [sin texto]\n    [media del mensaje]: Cont...",
          "conversation_text": "- user (2026-02-13 12:38:06.532):\n    [texto del mensaje]: Este es un mensaje de prueba de nicolas\n\n...",
          "channel_provider_id": 4
        },
        "5": {
          "response": "Â¡Gracias por avisar! SÃ­, volvÃ­ a revisar: tu audio decÃ­a que querÃ­as info de **un curso de inteligen...",
          "threadId": "88c93f39-9b00-4e62-8009-18066cc981e0",
          "executionSteps": [
            {
              "id": "msg_0e185eeda98f7ba401698f21a600f4819688c995b1f8f49fc5",
              "role": "assistant",
              "content": "Â¡Gracias por avisar! SÃ­, volvÃ­ a revisar: tu audio decÃ­a que querÃ­as info de **un curso de inteligen...",
              "reasoning": "**Clarifying course registration**\n\nI need to apologize and acknowledge that the audio about AI is m...",
              "toolCalls": [
                {
                  "id": "call_MO9ILkObqHpJVNfwsDmbJCnV",
                  "name": "find_branches_information",
                  "toolType": "scenario",
                  "arguments": {
                    "age": 5
                  }
                }
              ],
              "tokenUsage": {
                "totalTokens": 7388,
                "promptTokens": 7059,
                "completionTokens": 329
              },
              "toolResponse": {
                "id": "call_MO9ILkObqHpJVNfwsDmbJCnV",
                "name": "find_branches_information",
                "result": "{\"tool_output\":{\"array\":[{\"bundle\":{\"branch_id\":1,\"nombre\":\"Salta\",\"direccion\":\"Buenos Aires 135, Pr...",
                "status": "ok",
                "toolType": "scenario",
                "executionLink": "954615/scenarios/3671815/logs/633c0d7fa104440e864bc46fae6f6aae"
              },
              "executionTimeMs": 7406,
              "agentIterationId": "c6643f0b-0ba7-46ca-9390-89c66bff3ed3"
            }
          ],
          "executionTimeMs": 15938,
          "tokenUsageSummary": {
            "totalTokens": 21237,
            "promptTokens": 20777,
            "completionTokens": 460
          },
          "lastAgentIterationId": "c6643f0b-0ba7-46ca-9390-89c66bff3ed3"
        },
        "7": {
          "rowsAffected": 1
        }
      }
    },
    "scenario": {
      "dlq": true,
      "slots": null,
      "dataloss": false,
      "maxErrors": 3,
      "autoCommit": true,
      "roundtrips": 1,
      "sequential": false,
      "confidential": false,
      "freshVariables": false,
      "autoCommitTriggerLast": true
    }
  }
}